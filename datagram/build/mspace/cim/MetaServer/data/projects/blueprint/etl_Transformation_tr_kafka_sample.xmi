<?xml version="1.0" encoding="ASCII"?>
<etl:Transformation xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:etl="http://www.neoflex.ru/meta/etl" name="tr_kafka_sample" label="tr_kafka_sample" sparkVersion="SPARK3" description="&#x41f;&#x440;&#x438;&#x43c;&#x435;&#x440; &#x447;&#x442;&#x435;&#x43d;&#x438;&#x44f; &#x438;&#x437; Kafka &#x438; &#x440;&#x430;&#x431;&#x43e;&#x442;&#x44b; &#x441; json &#x441;&#x442;&#x440;&#x43e;&#x43a;&#x43e;&#x439; &#x441; &#x43f;&#x43e;&#x43c;&#x43e;&#x449;&#x44c;&#x44e; &#x444;&#x443;&#x43d;&#x43a;&#x446;&#x438;&#x438; get_json_object.&#xA;&#xA;&#x414;&#x43b;&#x44f; &#x442;&#x435;&#x441;&#x442;&#x438;&#x440;&#x43e;&#x432;&#x430;&#x43d;&#x438;&#x44f; &#x43d;&#x435;&#x43e;&#x431;&#x445;&#x43e;&#x434;&#x438;&#x43c;&#x43e; &#x43e;&#x442;&#x43a;&#x440;&#x44b;&#x442;&#x44c; &#x442;&#x435;&#x440;&#x43c;&#x438;&#x43d;&#x430;&#x43b; &#x43d;&#x430; &#x43c;&#x430;&#x448;&#x438;&#x43d;&#x435; kafka &#xA;docker-compose -f bd-runtime/docker-compose.yml exec kafka /bin/bash&#xA;&#xA;&#x438; &#x432;&#x44b;&#x43f;&#x43e;&#x43b;&#x43d;&#x438;&#x442;&#x44c; &#x43a;&#x43e;&#x43c;&#x430;&#x43d;&#x434;&#x44b;:&#xA;bin/kafka-topics.sh --create --topic events --bootstrap-server localhost:9092&#xA;bin/kafka-console-producer.sh --topic events --bootstrap-server localhost:9092&#xA;>{&quot;name&quot;:&quot;Oleg&quot;}&#xA;>{&quot;name&quot;:&quot;Maksim&quot;}&#xA;&#xA;&#x43f;&#x440;&#x43e;&#x432;&#x435;&#x440;&#x438;&#x442;&#x44c; &#x441;&#x43e;&#x434;&#x435;&#x440;&#x436;&#x438;&#x43c;&#x43e;&#x435; &#x442;&#x43e;&#x43f;&#x438;&#x43a;&#x430;:&#xA;bin/kafka-console-consumer.sh --topic events --from-beginning --bootstrap-server localhost:9092" jsonView="{&quot;cells&quot;:[{&quot;type&quot;:&quot;devs.transformation.KafkaSource&quot;,&quot;size&quot;:{&quot;width&quot;:80,&quot;height&quot;:80},&quot;inPorts&quot;:[],&quot;outPorts&quot;:[&quot;out&quot;],&quot;ports&quot;:{&quot;groups&quot;:{&quot;in&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;left&quot;},&quot;attrs&quot;:{&quot;.port-body&quot;:{&quot;fill&quot;:&quot;white&quot;,&quot;magnet&quot;:&quot;passive&quot;,&quot;stroke&quot;:&quot;#000&quot;,&quot;r&quot;:10},&quot;.port-label&quot;:{&quot;text&quot;:&quot;&quot;,&quot;visibility&quot;:&quot;hidden&quot;,&quot;fill&quot;:&quot;#000&quot;},&quot;circle&quot;:{&quot;r&quot;:7,&quot;stroke&quot;:&quot;#4d4d4dde&quot;,&quot;stroke-width&quot;:1}},&quot;label&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;left&quot;,&quot;args&quot;:{&quot;y&quot;:10}}}},&quot;out&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;right&quot;},&quot;label&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;right&quot;,&quot;args&quot;:{&quot;y&quot;:10}}},&quot;attrs&quot;:{&quot;.port-body&quot;:{&quot;fill&quot;:&quot;#4d4d4dde&quot;,&quot;stroke&quot;:&quot;#000&quot;,&quot;r&quot;:10,&quot;magnet&quot;:true},&quot;.port-label&quot;:{&quot;text&quot;:&quot;&quot;,&quot;visibility&quot;:&quot;hidden&quot;,&quot;fill&quot;:&quot;#000&quot;},&quot;circle&quot;:{&quot;r&quot;:7,&quot;stroke&quot;:&quot;#4d4d4dde&quot;,&quot;stroke-width&quot;:1}}}},&quot;items&quot;:[{&quot;id&quot;:&quot;out&quot;,&quot;group&quot;:&quot;out&quot;,&quot;attrs&quot;:{&quot;.port-label&quot;:{&quot;text&quot;:&quot;out&quot;}}}]},&quot;position&quot;:{&quot;x&quot;:82,&quot;y&quot;:115},&quot;angle&quot;:0,&quot;id&quot;:&quot;35ce1e54-264e-47f4-8921-52f8677908c2&quot;,&quot;name&quot;:&quot;Kafka_0&quot;,&quot;z&quot;:1,&quot;attrs&quot;:{&quot;.label&quot;:{&quot;text&quot;:&quot;Kafka_0&quot;}}},{&quot;type&quot;:&quot;devs.transformation.Projection&quot;,&quot;size&quot;:{&quot;width&quot;:80,&quot;height&quot;:80},&quot;inPorts&quot;:[&quot;in&quot;],&quot;outPorts&quot;:[&quot;out&quot;],&quot;ports&quot;:{&quot;groups&quot;:{&quot;in&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;left&quot;},&quot;attrs&quot;:{&quot;.port-body&quot;:{&quot;fill&quot;:&quot;white&quot;,&quot;magnet&quot;:&quot;passive&quot;,&quot;stroke&quot;:&quot;#000&quot;,&quot;r&quot;:10},&quot;.port-label&quot;:{&quot;text&quot;:&quot;&quot;,&quot;visibility&quot;:&quot;hidden&quot;,&quot;fill&quot;:&quot;#000&quot;},&quot;circle&quot;:{&quot;r&quot;:7,&quot;stroke&quot;:&quot;#4d4d4dde&quot;,&quot;stroke-width&quot;:1}},&quot;label&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;left&quot;,&quot;args&quot;:{&quot;y&quot;:10}}}},&quot;out&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;right&quot;},&quot;label&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;right&quot;,&quot;args&quot;:{&quot;y&quot;:10}}},&quot;attrs&quot;:{&quot;.port-body&quot;:{&quot;fill&quot;:&quot;#4d4d4dde&quot;,&quot;stroke&quot;:&quot;#000&quot;,&quot;r&quot;:10,&quot;magnet&quot;:true},&quot;.port-label&quot;:{&quot;text&quot;:&quot;&quot;,&quot;visibility&quot;:&quot;hidden&quot;,&quot;fill&quot;:&quot;#000&quot;},&quot;circle&quot;:{&quot;r&quot;:7,&quot;stroke&quot;:&quot;#4d4d4dde&quot;,&quot;stroke-width&quot;:1}}}},&quot;items&quot;:[{&quot;id&quot;:&quot;in&quot;,&quot;group&quot;:&quot;in&quot;,&quot;attrs&quot;:{&quot;.port-label&quot;:{&quot;text&quot;:&quot;in&quot;}}},{&quot;id&quot;:&quot;out&quot;,&quot;group&quot;:&quot;out&quot;,&quot;attrs&quot;:{&quot;.port-label&quot;:{&quot;text&quot;:&quot;out&quot;}}}]},&quot;position&quot;:{&quot;x&quot;:225,&quot;y&quot;:175},&quot;angle&quot;:0,&quot;id&quot;:&quot;7dc1220a-a6df-4717-be25-4ea85cadcf01&quot;,&quot;name&quot;:&quot;Projection_3&quot;,&quot;z&quot;:2,&quot;attrs&quot;:{&quot;.label&quot;:{&quot;text&quot;:&quot;Projection_3&quot;}}},{&quot;type&quot;:&quot;devs.transformation.LocalTarget&quot;,&quot;size&quot;:{&quot;width&quot;:80,&quot;height&quot;:80},&quot;inPorts&quot;:[&quot;in&quot;],&quot;outPorts&quot;:[],&quot;ports&quot;:{&quot;groups&quot;:{&quot;in&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;left&quot;},&quot;attrs&quot;:{&quot;.port-body&quot;:{&quot;fill&quot;:&quot;white&quot;,&quot;magnet&quot;:&quot;passive&quot;,&quot;stroke&quot;:&quot;#000&quot;,&quot;r&quot;:10},&quot;.port-label&quot;:{&quot;text&quot;:&quot;&quot;,&quot;visibility&quot;:&quot;hidden&quot;,&quot;fill&quot;:&quot;#000&quot;},&quot;circle&quot;:{&quot;r&quot;:7,&quot;stroke&quot;:&quot;#4d4d4dde&quot;,&quot;stroke-width&quot;:1}},&quot;label&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;left&quot;,&quot;args&quot;:{&quot;y&quot;:10}}}},&quot;out&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;right&quot;},&quot;label&quot;:{&quot;position&quot;:{&quot;name&quot;:&quot;right&quot;,&quot;args&quot;:{&quot;y&quot;:10}}},&quot;attrs&quot;:{&quot;.port-body&quot;:{&quot;fill&quot;:&quot;#4d4d4dde&quot;,&quot;stroke&quot;:&quot;#000&quot;,&quot;r&quot;:10,&quot;magnet&quot;:true},&quot;.port-label&quot;:{&quot;text&quot;:&quot;&quot;,&quot;visibility&quot;:&quot;hidden&quot;,&quot;fill&quot;:&quot;#000&quot;},&quot;circle&quot;:{&quot;r&quot;:7,&quot;stroke&quot;:&quot;#4d4d4dde&quot;,&quot;stroke-width&quot;:1}}}},&quot;items&quot;:[{&quot;id&quot;:&quot;in&quot;,&quot;group&quot;:&quot;in&quot;,&quot;attrs&quot;:{&quot;.port-label&quot;:{&quot;text&quot;:&quot;in&quot;}}}]},&quot;position&quot;:{&quot;x&quot;:362,&quot;y&quot;:119},&quot;angle&quot;:0,&quot;id&quot;:&quot;68bac647-44a3-4b95-80ed-92f3db2f2363&quot;,&quot;name&quot;:&quot;Local_1&quot;,&quot;z&quot;:3,&quot;attrs&quot;:{&quot;.label&quot;:{&quot;text&quot;:&quot;Local_1&quot;}}},{&quot;type&quot;:&quot;devs.transformation.Flow&quot;,&quot;source&quot;:{&quot;id&quot;:&quot;35ce1e54-264e-47f4-8921-52f8677908c2&quot;,&quot;port&quot;:&quot;out&quot;},&quot;target&quot;:{&quot;id&quot;:&quot;7dc1220a-a6df-4717-be25-4ea85cadcf01&quot;,&quot;port&quot;:&quot;in&quot;},&quot;id&quot;:&quot;671a118a-2563-4171-8dd7-c6675104b51e&quot;,&quot;z&quot;:4,&quot;attrs&quot;:{}},{&quot;type&quot;:&quot;devs.transformation.Flow&quot;,&quot;source&quot;:{&quot;id&quot;:&quot;7dc1220a-a6df-4717-be25-4ea85cadcf01&quot;,&quot;port&quot;:&quot;out&quot;},&quot;target&quot;:{&quot;id&quot;:&quot;68bac647-44a3-4b95-80ed-92f3db2f2363&quot;,&quot;port&quot;:&quot;in&quot;},&quot;id&quot;:&quot;0177529c-41c5-4346-aed5-180aa3d9674a&quot;,&quot;z&quot;:5,&quot;attrs&quot;:{}}]}">
  <targets xsi:type="etl:LocalTarget" name="Local_1" label="Local_1" localFileName="/tmp/kafka_events.json" saveMode="OVERWRITE">
    <inputPort name="Local_1in">
      <fields name="key" dataTypeDomain="STRING"/>
      <fields name="value" dataTypeDomain="STRING"/>
      <fields name="name" dataTypeDomain="STRING"/>
    </inputPort>
  </targets>
  <transformationSteps xsi:type="etl:Projection" name="Projection_3" label="Projection_3">
    <outputPort name="Projection_3out">
      <fields xsi:type="etl:ProjectionField" name="key" dataTypeDomain="STRING" sourceFields="//@transformationSteps.0/@inputPort/@fields.0"/>
      <fields xsi:type="etl:ProjectionField" name="value" dataTypeDomain="STRING" sourceFields="//@transformationSteps.0/@inputPort/@fields.1" expression="cast(value as string)" fieldOperationType="SQL"/>
      <fields xsi:type="etl:ProjectionField" name="name" dataTypeDomain="STRING" sourceFields="//@transformationSteps.0/@inputPort/@fields.1" expression="get_json_object(cast(value as string), &quot;$$.name&quot;)" fieldOperationType="SQL"/>
    </outputPort>
    <inputPort name="Projection_3in">
      <fields name="key" dataTypeDomain="STRING"/>
      <fields name="value" dataTypeDomain="STRING"/>
    </inputPort>
  </transformationSteps>
  <sources xsi:type="etl:KafkaSource" name="Kafka_0" label="Kafka_0" bootstrapServers="kafka:9092" kafkaConsumeType="SUBSCRIBE" consumeOptionValue="events">
    <outputPort name="Kafka_0out">
      <fields name="key" dataTypeDomain="STRING"/>
      <fields name="value" dataTypeDomain="STRING"/>
    </outputPort>
  </sources>
  <transitions name="c717f1a7-6957-4bd2-b8b0-8d014fea26be" start="//@sources.0/@outputPort" finish="//@transformationSteps.0/@inputPort"/>
  <transitions name="92a6b1de-d269-4750-aaec-146917107f8a" start="//@transformationSteps.0/@outputPort" finish="//@targets.0/@inputPort"/>
  <auditInfo changeUser="admin" changeDateTime="2021-09-03T09:44:20.935+0000" createUser="admin" createDateTime="2021-03-10T08:30:27.043+0000"/>
</etl:Transformation>
